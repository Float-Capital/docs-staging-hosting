// Generated by ReScript, PLEASE EDIT WITH CARE
'use strict';

var Chai = require("../../bindings/chai/Chai.js");
var LetOps = require("../../library/LetOps.js");
var Staker = require("../../library/contracts/Staker.js");
var Globals = require("../../library/Globals.js");
var Helpers = require("../../library/Helpers.js");
var CONSTANTS = require("../../CONSTANTS.js");
var StakerSmocked = require("../../library/smock/StakerSmocked.js");

function testUnit(contracts, accounts) {
  describe("Staker Admin Functions", (function () {
          var marketIndex = Helpers.randomJsInteger(undefined);
          describe("changeFloatPercentage", (function () {
                  var newFloatPerc = Globals.bnFromString("42000000000000000");
                  var txPromiseRef = {
                    contents: Promise.resolve(undefined)
                  };
                  Globals.before_once$p(function (param) {
                        return LetOps.Await.let_(StakerSmocked.InternalMock.setupFunctionForUnitTesting(contracts.contents.staker, "changeFloatPercentage"), (function (param) {
                                      txPromiseRef.contents = contracts.contents.staker.changeFloatPercentage(newFloatPerc);
                                      return txPromiseRef.contents;
                                    }));
                      });
                  it("should call the onlyAdmin modifier", (function () {
                          return StakerSmocked.InternalMock.onlyAdminModifierLogicCallCheck(undefined);
                        }));
                  it("should call _changeFloatPercentage with correct argument", (function () {
                          return StakerSmocked.InternalMock._changeFloatPercentageCallCheck({
                                      newFloatPercentage: newFloatPerc
                                    });
                        }));
                  it("emits FloatPercentageUpdated with correct argument", (function () {
                          var partial_arg = Chai.callEmitEvents(txPromiseRef.contents, contracts.contents.staker, "FloatPercentageUpdated");
                          return function (param) {
                            return partial_arg.withArgs(newFloatPerc, param);
                          };
                        }));
                  it("should revert if !(0 < newFloatPercentage <= 100 percent)", (function () {
                          var testValueWithinBounds = Globals.bnFromString("420000000000000000");
                          var testValueOutOfBoundsLowSide = Globals.bnFromInt(0);
                          var testValueOutOfBoundsHighSide = Globals.bnFromString("1010000000000000000");
                          return LetOps.Await.let_(contracts.contents.staker._changeFloatPercentageExposed(testValueWithinBounds), (function (param) {
                                        return LetOps.Await.let_(Chai.expectRevert(contracts.contents.staker._changeFloatPercentageExposed(testValueOutOfBoundsLowSide), ""), (function (param) {
                                                      return Chai.expectRevert(contracts.contents.staker._changeFloatPercentageExposed(testValueOutOfBoundsHighSide), "");
                                                    }));
                                      }));
                        }));
                  it("should update floatPercentage correctly", (function () {
                          var randomNewFloatPerc = Globals.mul(Helpers.randomInteger(undefined), Globals.bnFromString("10000000"));
                          return LetOps.Await.let_(contracts.contents.staker._changeFloatPercentageExposed(randomNewFloatPerc), (function (param) {
                                        return LetOps.Await.let_(contracts.contents.staker.floatPercentage(), (function (floatPercAfterCall) {
                                                      return Chai.bnEqual(undefined, randomNewFloatPerc, floatPercAfterCall);
                                                    }));
                                      }));
                        }));
                  
                }));
          describe("changeUnstakeFee", (function () {
                  var unstakeFeeBasisPoints = Helpers.randomInteger(undefined);
                  var txPromiseRef = {
                    contents: Promise.resolve(undefined)
                  };
                  Globals.before_once$p(function (param) {
                        return LetOps.Await.let_(StakerSmocked.InternalMock.setupFunctionForUnitTesting(contracts.contents.staker, "changeUnstakeFee"), (function (param) {
                                      txPromiseRef.contents = contracts.contents.staker.changeUnstakeFee(marketIndex, unstakeFeeBasisPoints);
                                      return txPromiseRef.contents;
                                    }));
                      });
                  it("should call _changeUnstakeFee with correct arguments", (function () {
                          return StakerSmocked.InternalMock._changeUnstakeFeeCallCheck({
                                      marketIndex: marketIndex,
                                      newMarketUnstakeFee_e18: unstakeFeeBasisPoints
                                    });
                        }));
                  it("should emit StakeWithdrawalFeeUpdated with correct arguments", (function () {
                          return Chai.callEmitEvents(txPromiseRef.contents, contracts.contents.staker, "StakeWithdrawalFeeUpdated").withArgs(marketIndex, unstakeFeeBasisPoints);
                        }));
                  it("should not allow new unstake fee greater than 5 percent", (function () {
                          var adminWallet = accounts.contents[0];
                          var sixPercent = Globals.bnFromString("60000000000000000");
                          return LetOps.Await.let_(Chai.expectRevert(contracts.contents.staker.connect(adminWallet)._changeUnstakeFeeExposed(marketIndex, sixPercent), ""), (function (param) {
                                        
                                      }));
                        }));
                  it("should update unstake fee correctly", (function () {
                          var adminWallet = accounts.contents[0];
                          var newFeePercentageRandom = Globals.mul(Helpers.randomInteger(undefined), Globals.bnFromString("10000000"));
                          return LetOps.Await.let_(contracts.contents.staker.connect(adminWallet)._changeUnstakeFeeExposed(1, newFeePercentageRandom), (function (param) {
                                        return LetOps.Await.let_(contracts.contents.staker.marketUnstakeFee_e18(1), (function (feeAfterCall) {
                                                      return Chai.bnEqual(undefined, feeAfterCall, newFeePercentageRandom);
                                                    }));
                                      }));
                        }));
                  
                }));
          describe("changeBalanceIncentiveParameters", (function () {
                  var startingTestExponent = Globals.bnFromInt(1);
                  var updatedExponent = Globals.bnFromInt(2);
                  var safeExponentBitShifting = Globals.bnFromInt(50);
                  var txPromiseRef = {
                    contents: Promise.resolve(undefined)
                  };
                  Globals.before_once$p(function (param) {
                        return LetOps.Await.let_(StakerSmocked.InternalMock.setupFunctionForUnitTesting(contracts.contents.staker, "changeBalanceIncentiveParameters"), (function (param) {
                                      var stakerAddress = accounts.contents[5];
                                      txPromiseRef.contents = contracts.contents.staker.connect(stakerAddress).changeBalanceIncentiveParameters(23, startingTestExponent, Globals.zeroBn, safeExponentBitShifting);
                                      return txPromiseRef.contents;
                                    }));
                      });
                  it("should call the onlyAdmin Modifier", (function () {
                          return LetOps.Await.let_(contracts.contents.staker.changeBalanceIncentiveParameters(23, updatedExponent, Globals.zeroBn, safeExponentBitShifting), (function (param) {
                                        return StakerSmocked.InternalMock.onlyAdminModifierLogicCallCheck(undefined);
                                      }));
                        }));
                  it("should call _changeBalanceIncentiveExponent with correct arguments", (function () {
                          return StakerSmocked.InternalMock._changeBalanceIncentiveParametersCallCheck({
                                      marketIndex: 23,
                                      balanceIncentiveCurve_exponent: updatedExponent,
                                      balanceIncentiveCurve_equilibriumOffset: Globals.zeroBn,
                                      safeExponentBitShifting: safeExponentBitShifting
                                    });
                        }));
                  it("should emit BalanceIncentiveParamsUpdated with correct arguments", (function () {
                          return Chai.callEmitEvents(txPromiseRef.contents, contracts.contents.staker, "BalanceIncentiveParamsUpdated").withArgs(23, startingTestExponent, Globals.zeroBn, safeExponentBitShifting);
                        }));
                  it("should only allow (0 < new exponent)", (function () {
                          var adminWallet = accounts.contents[0];
                          var newExponentOutOfBoundsLowSide = Globals.bnFromInt(0);
                          return Chai.expectRevert(contracts.contents.staker.connect(adminWallet)._changeBalanceIncentiveParametersExposed(23, newExponentOutOfBoundsLowSide, Globals.zeroBn, safeExponentBitShifting), "");
                        }));
                  it("should ensure (-9e17 < new equilibrium offset < 9e17)", (function () {
                          var adminWallet = accounts.contents[0];
                          var balanceIncentiveCurve_exponent = Globals.bnFromInt(3);
                          var newOffsetOutOfBoundsHighSide = Globals.add(Globals.bnFromString("900000000000000000"), Helpers.randomTokenAmount(undefined));
                          var newOffsetOutOfBoundsLowSide = Globals.sub(Globals.bnFromString("-900000000000000000"), Helpers.randomTokenAmount(undefined));
                          return LetOps.Await.let_(Chai.expectRevert(contracts.contents.staker.connect(adminWallet)._changeBalanceIncentiveParametersExposed(23, balanceIncentiveCurve_exponent, newOffsetOutOfBoundsHighSide, safeExponentBitShifting), ""), (function (param) {
                                        return LetOps.Await.let_(Chai.expectRevert(contracts.contents.staker.connect(adminWallet)._changeBalanceIncentiveParametersExposed(23, balanceIncentiveCurve_exponent, newOffsetOutOfBoundsLowSide, safeExponentBitShifting), ""), (function (param) {
                                                      
                                                    }));
                                      }));
                        }));
                  it("should update incentive exponent correctly", (function () {
                          var adminWallet = accounts.contents[0];
                          var newExponent = Globals.bnFromInt(4);
                          var match = contracts.contents;
                          var longShortSmocked = match.longShortSmocked;
                          var staker = match.staker;
                          longShortSmocked.marketSideValueInPaymentToken.returns(CONSTANTS.tenToThe18);
                          return LetOps.Await.let_(Staker.setVariable(staker, "longShort", longShortSmocked.address), (function (param) {
                                        return LetOps.Await.let_(staker.connect(adminWallet)._changeBalanceIncentiveParametersExposed(23, newExponent, Globals.zeroBn, safeExponentBitShifting), (function (param) {
                                                      return LetOps.Await.let_(staker.balanceIncentiveCurve_exponent(23), (function (exponentAfterCall) {
                                                                    return Chai.bnEqual(undefined, exponentAfterCall, newExponent);
                                                                  }));
                                                    }));
                                      }));
                        }));
                  
                }));
          
        }));
  
}

exports.testUnit = testUnit;
/* Chai Not a pure module */
