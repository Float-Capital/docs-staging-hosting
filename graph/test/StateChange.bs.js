// Generated by ReScript, PLEASE EDIT WITH CARE
'use strict';

var Js_dict = require("rescript/lib/js/js_dict.js");
var Belt_Array = require("rescript/lib/js/belt_Array.js");
var Belt_Option = require("rescript/lib/js/belt_Option.js");

function getStateChange(param) {
  var eventName = param.eventName;
  var paramsObject = {};
  Belt_Array.forEach(param.params, (function (param) {
          paramsObject[param.paramName] = param.param;
          
        }));
  if (eventName === "V1") {
    return {
            TAG: /* V1 */0,
            _0: {
              admin: Belt_Option.getExn(Js_dict.get(paramsObject, "admin")),
              staker: Belt_Option.getExn(Js_dict.get(paramsObject, "staker")),
              tokenFactory: Belt_Option.getExn(Js_dict.get(paramsObject, "tokenFactory"))
            }
          };
  } else {
    return {
            TAG: /* Unclassified */5,
            _0: {
              name: eventName,
              data: paramsObject
            }
          };
  }
}

function getAllStateChangeEvents(allStateChangesRaw) {
  return allStateChangesRaw.then(function (rawStateChanges) {
              return Promise.resolve(Belt_Array.reduce(rawStateChanges, [], (function (currentArrayOfStateChanges, param) {
                                var timestamp = param.timestamp;
                                var blockNumber = param.blockNumber;
                                var id = param.id;
                                return Belt_Array.concat(currentArrayOfStateChanges, Belt_Array.map(param.txEventParamList, (function (eventRaw) {
                                                  return {
                                                          blockNumber: blockNumber.toNumber(),
                                                          timestamp: timestamp.toNumber(),
                                                          txHash: id,
                                                          data: getStateChange(eventRaw)
                                                        };
                                                })));
                              })));
            });
}

var emptyEventGroups_allV1Events = [];

var emptyEventGroups_allUnclassifiedEvents = [];

var emptyEventGroups = {
  allV1Events: emptyEventGroups_allV1Events,
  allUnclassifiedEvents: emptyEventGroups_allUnclassifiedEvents
};

function splitIntoEventGroups(allStateChanges) {
  return allStateChanges.then(function (stateChanges) {
              return Promise.resolve(Belt_Array.reduce(stateChanges, emptyEventGroups, (function (currentEventGroups, param) {
                                var data = param.data;
                                if (data.TAG === /* V1 */0) {
                                  return {
                                          allV1Events: Belt_Array.concat(currentEventGroups.allV1Events, [{
                                                  blockNumber: param.blockNumber,
                                                  timestamp: param.timestamp,
                                                  txHash: param.txHash,
                                                  data: data._0
                                                }]),
                                          allUnclassifiedEvents: currentEventGroups.allUnclassifiedEvents
                                        };
                                } else {
                                  return currentEventGroups;
                                }
                              })));
            });
}

exports.getStateChange = getStateChange;
exports.getAllStateChangeEvents = getAllStateChangeEvents;
exports.emptyEventGroups = emptyEventGroups;
exports.splitIntoEventGroups = splitIntoEventGroups;
/* No side effect */
