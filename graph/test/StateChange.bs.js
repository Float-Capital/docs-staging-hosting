// Generated by ReScript, PLEASE EDIT WITH CARE
'use strict';

var BnJs = require("bn.js");
var Js_dict = require("rescript/lib/js/js_dict.js");
var Belt_Array = require("rescript/lib/js/belt_Array.js");
var Belt_Option = require("rescript/lib/js/belt_Option.js");

function getBnParam(paramsObject, paramName) {
  return Belt_Option.getExn(Belt_Option.map(Js_dict.get(paramsObject, paramName), (function (prim) {
                    return new BnJs(prim);
                  })));
}

function getStr(paramsObject, paramName) {
  return Belt_Option.getExn(Js_dict.get(paramsObject, paramName));
}

function getStateChange(param) {
  var eventName = param.eventName;
  var paramsObject = {};
  Belt_Array.forEach(param.params, (function (param) {
          paramsObject[param.paramName] = param.param;
          
        }));
  switch (eventName) {
    case "Approval" :
        return /* Approval */5;
    case "DeployV1" :
        return /* DeployV1 */3;
    case "FeesChanges" :
        return {
                TAG: /* FeesChanges */11,
                _0: {
                  TODO: "This isn't implemented"
                }
              };
    case "FeesLevied" :
        return {
                TAG: /* FeesLevied */3,
                _0: {
                  TODO: "This isn't implemented"
                }
              };
    case "FloatMinted" :
        return /* FloatMinted */2;
    case "LongMinted" :
        return {
                TAG: /* LongMinted */7,
                _0: {
                  TODO: "This isn't implemented"
                }
              };
    case "LongRedeem" :
        return {
                TAG: /* LongRedeem */9,
                _0: {
                  TODO: "This isn't implemented"
                }
              };
    case "PriceUpdate" :
        return {
                TAG: /* PriceUpdate */6,
                _0: {
                  TODO: "This isn't implemented"
                }
              };
    case "ShortMinted" :
        return {
                TAG: /* ShortMinted */8,
                _0: {
                  TODO: "This isn't implemented"
                }
              };
    case "ShortRedeem" :
        return {
                TAG: /* ShortRedeem */10,
                _0: {
                  TODO: "This isn't implemented"
                }
              };
    case "StakeAdded" :
        return /* StakeAdded */0;
    case "StateAdded" :
        return /* StateAdded */1;
    case "SyntheticTokenCreat" :
        return {
                TAG: /* SyntheticTokenCreat */4,
                _0: {
                  TODO: "This isn't implemented"
                }
              };
    case "SyntheticTokenCreated" :
        return {
                TAG: /* SyntheticTokenCreated */5,
                _0: {
                  TODO: "This isn't implemented"
                }
              };
    case "TokenPriceRefreshed" :
        return {
                TAG: /* TokenPriceRefreshed */2,
                _0: {
                  TODO: "This isn't implemented"
                }
              };
    case "Transfer" :
        return /* Transfer */4;
    case "V1" :
        return {
                TAG: /* V1 */0,
                _0: {
                  admin: Belt_Option.getExn(Js_dict.get(paramsObject, "admin")),
                  staker: Belt_Option.getExn(Js_dict.get(paramsObject, "staker")),
                  tokenFactory: Belt_Option.getExn(Js_dict.get(paramsObject, "tokenFactory"))
                }
              };
    case "ValueLockedInSystem" :
        return {
                TAG: /* ValueLockedInSystem */1,
                _0: {
                  marketIndex: getBnParam(paramsObject, "marketIndex"),
                  totalValueLockedInMarket: getBnParam(paramsObject, "totalValueLockedInMarket"),
                  longValue: getBnParam(paramsObject, "longValue"),
                  shortValue: getBnParam(paramsObject, "shortValue")
                }
              };
    default:
      return {
              TAG: /* Unclassified */12,
              _0: {
                name: eventName,
                data: paramsObject
              }
            };
  }
}

function getAllStateChangeEvents(allStateChangesRaw) {
  return allStateChangesRaw.then(function (rawStateChanges) {
              return Promise.resolve(Belt_Array.reduce(rawStateChanges, [], (function (currentArrayOfStateChanges, param) {
                                var timestamp = param.timestamp;
                                var blockNumber = param.blockNumber;
                                var id = param.id;
                                return Belt_Array.concat(currentArrayOfStateChanges, Belt_Array.map(param.txEventParamList, (function (eventRaw) {
                                                  return {
                                                          blockNumber: blockNumber.toNumber(),
                                                          timestamp: timestamp.toNumber(),
                                                          txHash: id,
                                                          data: getStateChange(eventRaw)
                                                        };
                                                })));
                              })));
            });
}

var emptyEventGroups_allV1Events = [];

var emptyEventGroups_allUnclassifiedEvents = [];

var emptyEventGroups = {
  allV1Events: emptyEventGroups_allV1Events,
  allUnclassifiedEvents: emptyEventGroups_allUnclassifiedEvents
};

function splitIntoEventGroups(allStateChanges) {
  return allStateChanges.then(function (stateChanges) {
              return Promise.resolve(Belt_Array.reduce(stateChanges, emptyEventGroups, (function (currentEventGroups, param) {
                                var data = param.data;
                                if (typeof data === "number") {
                                  return currentEventGroups;
                                }
                                switch (data.TAG | 0) {
                                  case /* V1 */0 :
                                      return {
                                              allV1Events: Belt_Array.concat(currentEventGroups.allV1Events, [{
                                                      blockNumber: param.blockNumber,
                                                      timestamp: param.timestamp,
                                                      txHash: param.txHash,
                                                      data: data._0
                                                    }]),
                                              allUnclassifiedEvents: currentEventGroups.allUnclassifiedEvents
                                            };
                                  case /* Unclassified */12 :
                                      return {
                                              allV1Events: currentEventGroups.allV1Events,
                                              allUnclassifiedEvents: Belt_Array.concat(currentEventGroups.allUnclassifiedEvents, [data._0])
                                            };
                                  default:
                                    return currentEventGroups;
                                }
                              })));
            });
}

exports.getBnParam = getBnParam;
exports.getStr = getStr;
exports.getStateChange = getStateChange;
exports.getAllStateChangeEvents = getAllStateChangeEvents;
exports.emptyEventGroups = emptyEventGroups;
exports.splitIntoEventGroups = splitIntoEventGroups;
/* bn.js Not a pure module */
