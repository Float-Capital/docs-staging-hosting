// Generated by Codegen.res, PLEASE EDIT WITH CARE

open ConverterTypes

@decco.decode
type stateAddedData = {
  tokenAddress: address,
  stateIndex: bn,
  timestamp: bn,
  accumulative: bn,
}
@decco.decode
type valueLockedInSystemData = {
  marketIndex: bn,
  totalValueLockedInMarket: bn,
  longValue: bn,
  shortValue: bn,
}
@decco.decode
type stakeAddedData = {
  user: address,
  tokenAddress: address,
  amount: bn,
  lastMintIndex: bn,
}
@decco.decode
type priceUpdateData = {
  marketIndex: bn,
  newPrice: bn,
  oldPrice: bn,
  user: address,
}
@decco.decode
type tokenPriceRefreshedData = {
  marketIndex: bn,
  longTokenPrice: bn,
  shortTokenPrice: bn,
}
@decco.decode
type transferData = {
  from: address,
  to: address,
  amount: bn,
}
@decco.decode
type approvalData = {
  owner: address,
  spender: address,
  value: bn,
}
@decco.decode
type shortMintedData = {
  marketIndex: bn,
  depositAdded: bn,
  finalDepositAmount: bn,
  tokensMinted: bn,
  user: address,
}
@decco.decode
type shortRedeemData = {
  marketIndex: bn,
  tokensRedeemed: bn,
  valueOfRedemption: bn,
  finalRedeem: bn,
  user: address,
}
@decco.decode
type v1Data = {
  admin: address,
  tokenFactory: address,
  staker: address,
}
@decco.decode
type longMintedData = {
  marketIndex: bn,
  depositAdded: bn,
  finalDepositAmount: bn,
  tokensMinted: bn,
  user: address,
}
@decco.decode
type feesChangesData = {
  marketIndex: bn,
  baseEntryFee: bn,
  badLiquidityEntryFee: bn,
  baseExitFee: bn,
  badLiquidityExitFee: bn,
}
@decco.decode
type kFactorParametersChangesData = {
  marketIndex: bn,
  period: bn,
  multiplier: bn,
}
@decco.decode
type longRedeemData = {
  marketIndex: bn,
  tokensRedeemed: bn,
  valueOfRedemption: bn,
  finalRedeem: bn,
  user: address,
}
@decco.decode
type syntheticTokenCreatedData = {
  marketIndex: bn,
  longTokenAddress: address,
  shortTokenAddress: address,
  assetPrice: bn,
  name: string,
  symbol: string,
  oracleAddress: address,
  collateralAddress: address,
}
@decco.decode
type deployV1Data = {
  floatAddress: address,
}
@decco.decode
type floatMintedData = {
  user: address,
  tokenAddress: address,
  amount: bn,
  lastMintIndex: bn,
}

type stateChanges =
  | Unclassified(unclassifiedEvent)
  | StateAdded(stateAddedData)
  | ValueLockedInSystem(valueLockedInSystemData)
  | StakeAdded(stakeAddedData)
  | PriceUpdate(priceUpdateData)
  | TokenPriceRefreshed(tokenPriceRefreshedData)
  | Transfer(transferData)
  | Approval(approvalData)
  | ShortMinted(shortMintedData)
  | ShortRedeem(shortRedeemData)
  | V1(v1Data)
  | LongMinted(longMintedData)
  | FeesChanges(feesChangesData)
  | KFactorParametersChanges(kFactorParametersChangesData)
  | LongRedeem(longRedeemData)
  | SyntheticTokenCreated(syntheticTokenCreatedData)
  | DeployV1(deployV1Data)
  | FloatMinted(floatMintedData)

let covertToStateChange = (eventName, paramsObject) => {
  // TODO: throw a (descriptive) error if the array of parameters are wrong somehow (or make a separate test?)
  switch eventName {
  | "StateAdded" => StateAdded(paramsObject->Js.Json.object_->stateAddedData_decode->Result.getExn)
  | "ValueLockedInSystem" => ValueLockedInSystem(paramsObject->Js.Json.object_->valueLockedInSystemData_decode->Result.getExn)
  | "StakeAdded" => StakeAdded(paramsObject->Js.Json.object_->stakeAddedData_decode->Result.getExn)
  | "PriceUpdate" => PriceUpdate(paramsObject->Js.Json.object_->priceUpdateData_decode->Result.getExn)
  | "TokenPriceRefreshed" => TokenPriceRefreshed(paramsObject->Js.Json.object_->tokenPriceRefreshedData_decode->Result.getExn)
  | "Transfer" => Transfer(paramsObject->Js.Json.object_->transferData_decode->Result.getExn)
  | "Approval" => Approval(paramsObject->Js.Json.object_->approvalData_decode->Result.getExn)
  | "ShortMinted" => ShortMinted(paramsObject->Js.Json.object_->shortMintedData_decode->Result.getExn)
  | "ShortRedeem" => ShortRedeem(paramsObject->Js.Json.object_->shortRedeemData_decode->Result.getExn)
  | "V1" => V1(paramsObject->Js.Json.object_->v1Data_decode->Result.getExn)
  | "LongMinted" => LongMinted(paramsObject->Js.Json.object_->longMintedData_decode->Result.getExn)
  | "FeesChanges" => FeesChanges(paramsObject->Js.Json.object_->feesChangesData_decode->Result.getExn)
  | "KFactorParametersChanges" => KFactorParametersChanges(paramsObject->Js.Json.object_->kFactorParametersChangesData_decode->Result.getExn)
  | "LongRedeem" => LongRedeem(paramsObject->Js.Json.object_->longRedeemData_decode->Result.getExn)
  | "SyntheticTokenCreated" => SyntheticTokenCreated(paramsObject->Js.Json.object_->syntheticTokenCreatedData_decode->Result.getExn)
  | "DeployV1" => DeployV1(paramsObject->Js.Json.object_->deployV1Data_decode->Result.getExn)
  | "FloatMinted" => FloatMinted(paramsObject->Js.Json.object_->floatMintedData_decode->Result.getExn)
  | name => Unclassified({name: name, data: paramsObject})
  }
}

type eventGroup = {
  allStateAddedEvents: array<eventData<stateAddedData>>,
  allValueLockedInSystemEvents: array<eventData<valueLockedInSystemData>>,
  allStakeAddedEvents: array<eventData<stakeAddedData>>,
  allPriceUpdateEvents: array<eventData<priceUpdateData>>,
  allTokenPriceRefreshedEvents: array<eventData<tokenPriceRefreshedData>>,
  allTransferEvents: array<eventData<transferData>>,
  allApprovalEvents: array<eventData<approvalData>>,
  allShortMintedEvents: array<eventData<shortMintedData>>,
  allShortRedeemEvents: array<eventData<shortRedeemData>>,
  allV1Events: array<eventData<v1Data>>,
  allLongMintedEvents: array<eventData<longMintedData>>,
  allFeesChangesEvents: array<eventData<feesChangesData>>,
  allKFactorParametersChangesEvents: array<eventData<kFactorParametersChangesData>>,
  allLongRedeemEvents: array<eventData<longRedeemData>>,
  allSyntheticTokenCreatedEvents: array<eventData<syntheticTokenCreatedData>>,
  allDeployV1Events: array<eventData<deployV1Data>>,
  allFloatMintedEvents: array<eventData<floatMintedData>>,
  allUnclassifiedEvents: array<ConverterTypes.unclassifiedEvent>,
}
let emptyEventGroups = {
  allStateAddedEvents: [],
  allValueLockedInSystemEvents: [],
  allStakeAddedEvents: [],
  allPriceUpdateEvents: [],
  allTokenPriceRefreshedEvents: [],
  allTransferEvents: [],
  allApprovalEvents: [],
  allShortMintedEvents: [],
  allShortRedeemEvents: [],
  allV1Events: [],
  allLongMintedEvents: [],
  allFeesChangesEvents: [],
  allKFactorParametersChangesEvents: [],
  allLongRedeemEvents: [],
  allSyntheticTokenCreatedEvents: [],
  allDeployV1Events: [],
  allFloatMintedEvents: [],
  allUnclassifiedEvents: [],
}

let addEventToCorrectGrouping = (
  currentEventGroups,
  {ConverterTypes.blockNumber: blockNumber, timestamp, txHash, data},
) => {
  switch data {
  | StateAdded(eventData) => {
      ...currentEventGroups,
      allStateAddedEvents: currentEventGroups.allStateAddedEvents->Array.concat([
        {blockNumber: blockNumber, timestamp: timestamp, data: eventData, txHash: txHash},
      ]),
    }
  | ValueLockedInSystem(eventData) => {
      ...currentEventGroups,
      allValueLockedInSystemEvents: currentEventGroups.allValueLockedInSystemEvents->Array.concat([
        {blockNumber: blockNumber, timestamp: timestamp, data: eventData, txHash: txHash},
      ]),
    }
  | StakeAdded(eventData) => {
      ...currentEventGroups,
      allStakeAddedEvents: currentEventGroups.allStakeAddedEvents->Array.concat([
        {blockNumber: blockNumber, timestamp: timestamp, data: eventData, txHash: txHash},
      ]),
    }
  | PriceUpdate(eventData) => {
      ...currentEventGroups,
      allPriceUpdateEvents: currentEventGroups.allPriceUpdateEvents->Array.concat([
        {blockNumber: blockNumber, timestamp: timestamp, data: eventData, txHash: txHash},
      ]),
    }
  | TokenPriceRefreshed(eventData) => {
      ...currentEventGroups,
      allTokenPriceRefreshedEvents: currentEventGroups.allTokenPriceRefreshedEvents->Array.concat([
        {blockNumber: blockNumber, timestamp: timestamp, data: eventData, txHash: txHash},
      ]),
    }
  | Transfer(eventData) => {
      ...currentEventGroups,
      allTransferEvents: currentEventGroups.allTransferEvents->Array.concat([
        {blockNumber: blockNumber, timestamp: timestamp, data: eventData, txHash: txHash},
      ]),
    }
  | Approval(eventData) => {
      ...currentEventGroups,
      allApprovalEvents: currentEventGroups.allApprovalEvents->Array.concat([
        {blockNumber: blockNumber, timestamp: timestamp, data: eventData, txHash: txHash},
      ]),
    }
  | ShortMinted(eventData) => {
      ...currentEventGroups,
      allShortMintedEvents: currentEventGroups.allShortMintedEvents->Array.concat([
        {blockNumber: blockNumber, timestamp: timestamp, data: eventData, txHash: txHash},
      ]),
    }
  | ShortRedeem(eventData) => {
      ...currentEventGroups,
      allShortRedeemEvents: currentEventGroups.allShortRedeemEvents->Array.concat([
        {blockNumber: blockNumber, timestamp: timestamp, data: eventData, txHash: txHash},
      ]),
    }
  | V1(eventData) => {
      ...currentEventGroups,
      allV1Events: currentEventGroups.allV1Events->Array.concat([
        {blockNumber: blockNumber, timestamp: timestamp, data: eventData, txHash: txHash},
      ]),
    }
  | LongMinted(eventData) => {
      ...currentEventGroups,
      allLongMintedEvents: currentEventGroups.allLongMintedEvents->Array.concat([
        {blockNumber: blockNumber, timestamp: timestamp, data: eventData, txHash: txHash},
      ]),
    }
  | FeesChanges(eventData) => {
      ...currentEventGroups,
      allFeesChangesEvents: currentEventGroups.allFeesChangesEvents->Array.concat([
        {blockNumber: blockNumber, timestamp: timestamp, data: eventData, txHash: txHash},
      ]),
    }
  | KFactorParametersChanges(eventData) => {
      ...currentEventGroups,
      allKFactorParametersChangesEvents: currentEventGroups.allKFactorParametersChangesEvents->Array.concat([
        {blockNumber: blockNumber, timestamp: timestamp, data: eventData, txHash: txHash},
      ]),
    }
  | LongRedeem(eventData) => {
      ...currentEventGroups,
      allLongRedeemEvents: currentEventGroups.allLongRedeemEvents->Array.concat([
        {blockNumber: blockNumber, timestamp: timestamp, data: eventData, txHash: txHash},
      ]),
    }
  | SyntheticTokenCreated(eventData) => {
      ...currentEventGroups,
      allSyntheticTokenCreatedEvents: currentEventGroups.allSyntheticTokenCreatedEvents->Array.concat([
        {blockNumber: blockNumber, timestamp: timestamp, data: eventData, txHash: txHash},
      ]),
    }
  | DeployV1(eventData) => {
      ...currentEventGroups,
      allDeployV1Events: currentEventGroups.allDeployV1Events->Array.concat([
        {blockNumber: blockNumber, timestamp: timestamp, data: eventData, txHash: txHash},
      ]),
    }
  | FloatMinted(eventData) => {
      ...currentEventGroups,
      allFloatMintedEvents: currentEventGroups.allFloatMintedEvents->Array.concat([
        {blockNumber: blockNumber, timestamp: timestamp, data: eventData, txHash: txHash},
      ]),
    }
  | Unclassified(event) => {
      ...currentEventGroups,
      allUnclassifiedEvents: currentEventGroups.allUnclassifiedEvents->Array.concat([event]),
    }
  }
}

