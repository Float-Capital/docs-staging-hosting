// Generated by ReScript, PLEASE EDIT WITH CARE
'use strict';

var Curry = require("rescript/lib/js/curry.js");
var React = require("react");
var Button = require("../UI/Base/Button.js");
var Client = require("../../data/Client.js");
var Config = require("../../config/Config.js");
var Ethers = require("../../ethereum/Ethers.js");
var Queries = require("../../data/Queries.js");
var Contracts = require("../../ethereum/Contracts.js");
var RootProvider = require("../../libraries/RootProvider.js");
var ToastProvider = require("../UI/ToastProvider.js");

function Withdraw(Props) {
  var marketIndex = Props.marketIndex;
  var txState = Props.txState;
  var contractExecutionHandler = Props.contractExecutionHandler;
  var user = RootProvider.useCurrentUserExn(undefined);
  var toastDispatch = React.useContext(ToastProvider.DispatchToastContext.context);
  var client = Client.useApolloClient(undefined);
  var reqVariables = {
    userId: Ethers.Utils.ethAdrToLowerStr(user)
  };
  React.useEffect((function () {
          if (typeof txState === "number") {
            if (txState !== /* UnInitialised */0) {
              Curry._1(toastDispatch, {
                    _0: "Confirm withdraw transaction in your wallet",
                    _1: "",
                    _2: /* Info */2,
                    [Symbol.for("name")]: "Show"
                  });
            }
            
          } else {
            switch (txState.TAG | 0) {
              case /* SignedAndSubmitted */0 :
                  Curry._1(toastDispatch, {
                        _0: "withdraw transaction pending",
                        _1: "",
                        _2: /* Info */2,
                        [Symbol.for("name")]: "Show"
                      });
                  break;
              case /* Declined */1 :
                  Curry._1(toastDispatch, {
                        _0: "The transaction was rejected by your wallet",
                        _1: txState._0,
                        _2: /* Error */0,
                        [Symbol.for("name")]: "Show"
                      });
                  break;
              case /* Complete */2 :
                  Curry._1(toastDispatch, {
                        _0: "Withdraw transaction confirmed ðŸŽ‰",
                        _1: "",
                        _2: /* Success */3,
                        [Symbol.for("name")]: "Show"
                      });
                  break;
              case /* Failed */3 :
                  Curry._1(toastDispatch, {
                        _0: "The transaction failed",
                        _1: "",
                        _2: /* Error */0,
                        [Symbol.for("name")]: "Show"
                      });
                  break;
              
            }
          }
          
        }), [txState]);
  React.useEffect((function () {
          var timeout = setTimeout((function (param) {
                  Curry._6(client.rescript_query, {
                          query: Queries.UsersConfirmedRedeems.query,
                          Raw: Queries.UsersConfirmedRedeems.Raw,
                          parse: Queries.UsersConfirmedRedeems.parse,
                          serialize: Queries.UsersConfirmedRedeems.serialize,
                          serializeVariables: Queries.UsersConfirmedRedeems.serializeVariables
                        }, undefined, undefined, /* NetworkOnly */2, undefined, reqVariables).then(function (queryResult) {
                        if (queryResult.TAG === /* Ok */0 && queryResult._0.data.user !== undefined) {
                          Curry._1(client.rescript_writeQuery, {
                                query: Queries.UsersConfirmedRedeems.query,
                                Raw: Queries.UsersConfirmedRedeems.Raw,
                                parse: Queries.UsersConfirmedRedeems.parse,
                                serialize: Queries.UsersConfirmedRedeems.serialize,
                                serializeVariables: Queries.UsersConfirmedRedeems.serializeVariables
                              });
                          return ;
                        }
                        
                      });
                  
                }), 1000);
          return (function (param) {
                    clearTimeout(timeout);
                    
                  });
        }), [txState]);
  return React.createElement(Button.Tiny.make, {
              onClick: (function (param) {
                  return Curry._2(contractExecutionHandler, (function (param) {
                                return Contracts.LongShort.make(Config.longShort, param);
                              }), (function (param) {
                                return param.executeOutstandingNextPriceSettlementsUser(user, marketIndex);
                              }));
                }),
              children: "Withdraw DAI"
            });
}

var make = Withdraw;

exports.make = make;
/* react Not a pure module */
