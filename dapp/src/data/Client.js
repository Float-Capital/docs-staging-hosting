// Generated by ReScript, PLEASE EDIT WITH CARE

import * as React from "react";
import * as Config from "../Config.js";
import * as Ethers from "../ethereum/Ethers.js";
import * as Caml_option from "bs-platform/lib/es6/caml_option.js";
import * as ApolloClient from "rescript-apollo-client/src/ApolloClient.js";
import * as Client from "@apollo/client";
import * as ReasonMLCommunity__ApolloClient from "rescript-apollo-client/src/ReasonMLCommunity__ApolloClient.js";
import * as ApolloClient__Link_Http_HttpLink from "rescript-apollo-client/src/@apollo/client/link/http/ApolloClient__Link_Http_HttpLink.js";
import * as ApolloClient__Cache_InMemory_InMemoryCache from "rescript-apollo-client/src/@apollo/client/cache/inmemory/ApolloClient__Cache_InMemory_InMemoryCache.js";

function chainContextToStr(chain) {
  if (chain) {
    return "db";
  } else {
    return "graph";
  }
}

function createContext(queryType) {
  return {
          context: queryType
        };
}

function httpLink(uri) {
  return ApolloClient__Link_Http_HttpLink.make((function (param) {
                return uri;
              }), undefined, undefined, undefined, undefined, undefined, undefined, undefined);
}

function setSignInData(ethAddress, ethSignature) {
  localStorage.setItem(ethAddress, ethSignature);
  
}

function getAuthHeaders(user) {
  if (user === undefined) {
    return ;
  }
  var u = Caml_option.valFromOption(user);
  var getUserSignature = function (__x) {
    return Caml_option.null_to_opt(__x.getItem(Ethers.Utils.ethAdrToLowerStr(u)));
  };
  var uS = getUserSignature(localStorage);
  if (uS !== undefined) {
    return {
            "eth-address": Ethers.Utils.ethAdrToLowerStr(u),
            "eth-signature": uS
          };
  }
  
}

function querySwitcherLink(graphUri, dbUri, user) {
  var headers = getAuthHeaders(user);
  return ReasonMLCommunity__ApolloClient.Link.split((function (operation) {
                var context = operation.getContext();
                if (context !== undefined && context.context) {
                  return false;
                } else {
                  return true;
                }
              }), httpLink(graphUri), ApolloClient__Link_Http_HttpLink.make((function (param) {
                    return dbUri;
                  }), undefined, undefined, Caml_option.some(headers !== undefined ? headers : (function (prim) {
                          return {};
                        })), undefined, undefined, undefined, undefined));
}

function makeClient(graphUri, dbUri, user) {
  return ApolloClient.make(undefined, undefined, undefined, Caml_option.some(querySwitcherLink(graphUri, dbUri, user)), ApolloClient__Cache_InMemory_InMemoryCache.make(undefined, undefined, undefined, undefined, undefined, undefined), undefined, undefined, true, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined, undefined);
}

var defaultClient = makeClient(Config.binancTestnetGraphEndpoint, "http://localhost:8080/v1/graphql", undefined);

var context = React.createContext(defaultClient);

var provider = context.Provider;

function useApolloClient(param) {
  return React.useContext(context);
}

function Client$GraphQl(Props) {
  var children = Props.children;
  var client = React.useContext(context);
  return React.createElement(Client.ApolloProvider, {
              client: client,
              children: children
            });
}

var GraphQl = {
  make: Client$GraphQl
};

function Client$Provider(Props) {
  var children = Props.children;
  return React.createElement(provider, {
              value: defaultClient,
              children: children
            });
}

var Provider = {
  make: Client$Provider
};

function Client$1(Props) {
  var children = Props.children;
  return React.createElement(Client$Provider, {
              children: React.createElement(Client$GraphQl, {
                    children: children
                  })
            });
}

var make = Client$1;

export {
  chainContextToStr ,
  createContext ,
  httpLink ,
  setSignInData ,
  getAuthHeaders ,
  querySwitcherLink ,
  makeClient ,
  defaultClient ,
  context ,
  provider ,
  useApolloClient ,
  GraphQl ,
  Provider ,
  make ,
  
}
/* defaultClient Not a pure module */
